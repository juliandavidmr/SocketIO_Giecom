<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Title</title>
  </head>
  <body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script>
      $(document).ready(function() {
        // Connect to our node/websockets server
        var ip = 'http://localhost:';
        var port = 3000;
        var dir = ip + port;
        var socket = io.connect(dir);

        // Initial set of notes, loop through and add to list
        socket.on('initial notes', function(data) {
          var html = ''
          for (var i = 0; i < data.length; i++) {
            // We store html as a var then add to DOM after for efficiency
            html += '<li class=list-group-item >' + data[i].note + '</li>'
          }
          $('#notes').html(html)
        });

        // New note emitted, add it to our list of current notes
        socket.on('new note', function(data) {
          $('#notes').append('<li>' + data.note + '</li>')
        });

        // New socket connected, display new count on page
        socket.on('users connected', function(data) {
          $('#usersConnected').html('Users connected: ' + data)
        });

        socket.on('users connected', function(data) {
          $('#usersConnected').html('Online: ' + data)
        });

        // Add a new (random) note, emit to server to let others know
        $('#newNote').click(function() {
          var newNote = 'Nota aleatoria ' + (Math.floor(Math.random() * 100) + 1);
          socket.emit('new note', {note: newNote});
        });
      })
    </script>

    <div class="container">
      <div class="list-group">
        <a href="#" class="list-group-item active">
          Listado de notas, <div id="usersConnected"></div>
        </a>
        <div class="row">
          <!-- /.col-lg-6 -->
          <div class="col-lg-12">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Nuevo item">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button">Agregar</button>
              </span>
            </div>
            <!-- /input-group -->
          </div>
          <!-- /.col-lg-6 -->
        </div>
        <!-- /.row -->
        <a id="notes" class="list-group-item"></a>
      </div>
      <div id="newNote">Create a new note</div>
    </div>
  </body>
</html>
